<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Pulse Briefing - 2025-11-24</title>
    <link rel="stylesheet" href="../style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function toggleEvent(id) {
            const content = document.getElementById('content-' + id);
            const button = document.getElementById('btn-' + id);
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                button.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                button.textContent = 'â–¶';
            }
        }

        // Initialize charts when page loads
        window.addEventListener('DOMContentLoaded', function() {
            // Sentiment Chart
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            const chartData = {"dates": ["2025-11-24"], "positive": [0], "negative": [0], "neutral": [0], "mixed": [0], "totals": [0]};

            // If we have data, generate labels from first data date to 30 days ahead
            let labels = chartData.dates;
            let positiveData = chartData.positive;
            let negativeData = chartData.negative;
            let neutralData = chartData.neutral;
            let mixedData = chartData.mixed;
            let totalData = chartData.totals;

            // If we have at least one data point, extend to show future 30 days
            if (chartData.dates.length > 0) {
                const firstDate = new Date(chartData.dates[0]);
                const today = new Date();
                const endDate = new Date(today);
                endDate.setDate(endDate.getDate() + 30);

                // Generate all dates from first data point to 30 days ahead
                labels = [];
                const current = new Date(firstDate);
                while (current <= endDate) {
                    labels.push(current.toISOString().split('T')[0]);
                    current.setDate(current.getDate() + 1);
                }

                // Map data to full date range
                const mapData = (dates, values) => {
                    return labels.map(label => {
                        const index = dates.indexOf(label);
                        return index >= 0 ? values[index] : null;
                    });
                };

                positiveData = mapData(chartData.dates, chartData.positive);
                negativeData = mapData(chartData.dates, chartData.negative);
                neutralData = mapData(chartData.dates, chartData.neutral);
                mixedData = mapData(chartData.dates, chartData.mixed);
                totalData = mapData(chartData.dates, chartData.totals);
            }

            const sentimentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Positive',
                            data: positiveData,
                            borderColor: '#6ee7b7',
                            backgroundColor: 'rgba(110, 231, 183, 0.1)',
                            tension: 0.3,
                            spanGaps: true
                        },
                        {
                            label: 'Negative',
                            data: negativeData,
                            borderColor: '#fca5a5',
                            backgroundColor: 'rgba(252, 165, 165, 0.1)',
                            tension: 0.3,
                            spanGaps: true
                        },
                        {
                            label: 'Neutral',
                            data: neutralData,
                            borderColor: '#94a3b8',
                            backgroundColor: 'rgba(148, 163, 184, 0.1)',
                            tension: 0.3,
                            spanGaps: true
                        },
                        {
                            label: 'Mixed',
                            data: mixedData,
                            borderColor: '#fcd34d',
                            backgroundColor: 'rgba(252, 211, 77, 0.1)',
                            tension: 0.3,
                            spanGaps: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',  // Trigger on x-axis position
                        intersect: false  // Don't require hovering directly on points
                    },
                    onHover: function(event, activeElements, chart) {
                        // Get the x-position and find the nearest date index
                        const canvasPosition = Chart.helpers.getRelativePosition(event, chart);
                        const dataX = chart.scales.x.getValueForPixel(canvasPosition.x);

                        if (dataX !== null && dataX >= 0 && dataX < labels.length) {
                            const index = Math.round(dataX);
                            if (index >= 0 && index < labels.length) {
                                updateSentimentBreakdown(index, labels[index], positiveData[index], negativeData[index], neutralData[index], mixedData[index], totalData[index]);
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    const total = totalData[index];
                                    return context[0].label + ' (Total: ' + (total || 0) + ' events)';
                                },
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: '#334155'
                            }
                        }
                    }
                }
            });

            // Function to update sentiment breakdown display
            function updateSentimentBreakdown(index, date, positive, negative, neutral, mixed, total) {
                document.getElementById('breakdown-date').textContent = date;

                // Check if we have data for this date
                if (!total || total === 0 || positive === null) {
                    // No data - show placeholders
                    document.getElementById('breakdown-positive-pct').textContent = '-';
                    document.getElementById('breakdown-negative-pct').textContent = '-';
                    document.getElementById('breakdown-neutral-pct').textContent = '-';
                    document.getElementById('breakdown-mixed-pct').textContent = '-';
                    document.getElementById('breakdown-positive-count').textContent = '-';
                    document.getElementById('breakdown-negative-count').textContent = '-';
                    document.getElementById('breakdown-neutral-count').textContent = '-';
                    document.getElementById('breakdown-mixed-count').textContent = '-';
                    document.getElementById('breakdown-total').textContent = '-';
                } else {
                    // Has data - show actual values
                    document.getElementById('breakdown-positive-pct').textContent = (positive || 0).toFixed(1) + '%';
                    document.getElementById('breakdown-negative-pct').textContent = (negative || 0).toFixed(1) + '%';
                    document.getElementById('breakdown-neutral-pct').textContent = (neutral || 0).toFixed(1) + '%';
                    document.getElementById('breakdown-mixed-pct').textContent = (mixed || 0).toFixed(1) + '%';

                    // Calculate actual counts from percentages
                    const posCount = total > 0 ? Math.round(positive * total / 100) : 0;
                    const negCount = total > 0 ? Math.round(negative * total / 100) : 0;
                    const neuCount = total > 0 ? Math.round(neutral * total / 100) : 0;
                    const mixCount = total > 0 ? Math.round(mixed * total / 100) : 0;

                    document.getElementById('breakdown-positive-count').textContent = posCount;
                    document.getElementById('breakdown-negative-count').textContent = negCount;
                    document.getElementById('breakdown-neutral-count').textContent = neuCount;
                    document.getElementById('breakdown-mixed-count').textContent = mixCount;
                    document.getElementById('breakdown-total').textContent = total || 0;
                }

                // Highlight the breakdown section
                const breakdownSection = document.getElementById('sentiment-breakdown');
                breakdownSection.style.backgroundColor = 'rgba(110, 231, 183, 0.05)';
                setTimeout(() => {
                    breakdownSection.style.backgroundColor = '';
                }, 200);
            }

            // Market Performance Chart
            const marketCtx = document.getElementById('marketChart').getContext('2d');
            const marketData = {};
            const correlationData = {"total": 0, "correct": 0, "wrong": 0, "ambiguous": 0, "accuracy_pct": 0, "timeline": []};

            // Use same date range as sentiment chart (reuse labels from sentiment chart)
            const marketLabels = labels;

            // Define symbol display order and colors
            const symbolConfig = [
                {symbol: '^IXIC', label: 'NASDAQ', color: '#6ee7b7'},
                {symbol: '^GSPC', label: 'S&P 500', color: '#94a3b8'},
                {symbol: 'NVDA', label: 'NVIDIA', color: '#c084fc'},
                {symbol: 'MSFT', label: 'Microsoft', color: '#60a5fa'},
                {symbol: 'GOOGL', label: 'Alphabet', color: '#fbbf24'},
                {symbol: 'META', label: 'Meta', color: '#f87171'},
                {symbol: 'AMD', label: 'AMD', color: '#fb923c'},
                {symbol: 'PLTR', label: 'Palantir', color: '#34d399'},
                {symbol: 'BOTZ', label: 'AI/Robotics ETF', color: '#a78bfa'},
                {symbol: 'AIQ', label: 'AI Analytics ETF', color: '#f472b6'}
            ];

            // Map market data to full date range (align with sentiment chart dates)
            const mapMarketData = (symbolDates, symbolChanges) => {
                const dataMap = {};
                symbolDates.forEach((date, idx) => {
                    dataMap[date] = symbolChanges[idx];
                });
                return marketLabels.map(label => dataMap[label] !== undefined ? dataMap[label] : null);
            };

            // Build datasets for each symbol
            const marketDatasets = symbolConfig.map(config => {
                const symbolData = marketData[config.symbol];
                if (!symbolData) return null;

                return {
                    label: config.label,
                    symbol: config.symbol,  // Store symbol for lookup
                    data: mapMarketData(symbolData.dates, symbolData.changes),
                    borderColor: config.color,
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    hidden: true,  // All hidden by default
                    spanGaps: true  // Connect across missing data points
                };
            }).filter(d => d !== null);

            window.marketChart = new Chart(marketCtx, {
                type: 'line',
                data: {
                    labels: marketLabels,
                    datasets: marketDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false  // Using custom checkboxes instead
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,  // Dynamic scaling
                            afterDataLimits: function(axis) {
                                // Ensure minimum scale of Â±1%
                                const range = axis.max - axis.min;
                                if (range < 2) {
                                    const center = (axis.max + axis.min) / 2;
                                    axis.max = center + 1;
                                    axis.min = center - 1;
                                }
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value.toFixed(1) + '%';
                                }
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: '#334155'
                            }
                        }
                    }
                }
            });

            // Checkbox toggle functionality
            document.querySelectorAll('.market-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const symbol = this.dataset.symbol;
                    // Find dataset by matching symbol directly
                    const datasetIndex = window.marketChart.data.datasets.findIndex(ds => ds.symbol === symbol);

                    if (datasetIndex !== -1) {
                        window.marketChart.data.datasets[datasetIndex].hidden = !this.checked;
                        window.marketChart.update();
                    }
                });
            });
        });

        // Toggle all market symbols on/off
        function toggleAllMarketSymbols(checked) {
            document.querySelectorAll('.market-checkbox:not([disabled])').forEach(checkbox => {
                checkbox.checked = checked;

                const symbol = checkbox.dataset.symbol;
                // Find dataset by matching symbol directly
                const datasetIndex = window.marketChart.data.datasets.findIndex(ds => ds.symbol === symbol);

                if (datasetIndex !== -1) {
                    window.marketChart.data.datasets[datasetIndex].hidden = !checked;
                }
            });
            window.marketChart.update();
        }

        // Toggle visibility function for market checkboxes
        function toggleMarketSymbol(index) {
            const checkbox = document.getElementById('symbol-' + index);
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        }
    </script>
</head>
<body>
    <header>
        <div class="header-stats">
            <div class="stat-item">
                <span class="stat-value-small">0</span>
                <span class="stat-label-small">Events</span>
            </div>
            <div class="stat-item">
                <span class="stat-value-small">0</span>
                <span class="stat-label-small">Analyzed</span>
            </div>
            <div class="stat-item">
                <span class="stat-value-small">0</span>
                <span class="stat-label-small">Significant</span>
            </div>
        </div>

        <div class="header-center">
            <h1>ðŸ§  AI-Pulse</h1>
            <p class="date">2025-11-24 08:25 UTC</p>
        </div>

        <nav class="header-nav">
            <a href="../index.html">Latest</a>
            <a href="../archive.html">Archive</a>
            <a href="https://github.com/mat-e-exp/ai-pulse">GitHub</a>
        </nav>
    </header>

    <main>
        <section class="sentiment-box">
            <h3>Sentiment Trend (Last 30 Days)</h3>
            <div class="chart-container">
                <canvas id="sentimentChart"></canvas>
            </div>
            <div class="sentiment-current" id="sentiment-breakdown">
                <h4>Sentiment Breakdown <span id="breakdown-date" style="color: #6ee7b7; font-weight: normal;">(Hover over chart)</span></h4>
                <ul class="sentiment-list">
                    <li>
                        <span class="sentiment-positive">positive</span>:
                        <span id="breakdown-positive-pct">-</span>
                        <span style="color: #94a3b8; font-size: 0.9em;">(<span id="breakdown-positive-count">-</span> events)</span>
                    </li>
                    <li>
                        <span class="sentiment-negative">negative</span>:
                        <span id="breakdown-negative-pct">-</span>
                        <span style="color: #94a3b8; font-size: 0.9em;">(<span id="breakdown-negative-count">-</span> events)</span>
                    </li>
                    <li>
                        <span class="sentiment-neutral">neutral</span>:
                        <span id="breakdown-neutral-pct">-</span>
                        <span style="color: #94a3b8; font-size: 0.9em;">(<span id="breakdown-neutral-count">-</span> events)</span>
                    </li>
                    <li>
                        <span class="sentiment-mixed">mixed</span>:
                        <span id="breakdown-mixed-pct">-</span>
                        <span style="color: #94a3b8; font-size: 0.9em;">(<span id="breakdown-mixed-count">-</span> events)</span>
                    </li>
                    <li style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #334155;">
                        <strong>Total:</strong> <span id="breakdown-total">-</span> events analyzed
                    </li>
                </ul>
            </div>
        </section>

        <section class="sentiment-box">
            <h3>Market Performance (Last 30 Days)</h3>
            <div class="chart-container">
                <canvas id="marketChart"></canvas>
            </div>

            <div class="market-controls">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0;">Select Indices & Stocks</h4>
                    <div class="market-control-buttons">
                        <button onclick="toggleAllMarketSymbols(true)" class="market-control-btn">All</button>
                        <button onclick="toggleAllMarketSymbols(false)" class="market-control-btn">None</button>
                    </div>
                </div>
                <div class="checkbox-grid">

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-0" class="market-checkbox" data-symbol="^IXIC" disabled>
                        <span style="color: #6ee7b7">â– </span> NASDAQ
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-1" class="market-checkbox" data-symbol="^GSPC" disabled>
                        <span style="color: #94a3b8">â– </span> S&P 500
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-2" class="market-checkbox" data-symbol="NVDA" disabled>
                        <span style="color: #c084fc">â– </span> NVIDIA
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-3" class="market-checkbox" data-symbol="MSFT" disabled>
                        <span style="color: #60a5fa">â– </span> Microsoft
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-4" class="market-checkbox" data-symbol="GOOGL" disabled>
                        <span style="color: #fbbf24">â– </span> Alphabet
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-5" class="market-checkbox" data-symbol="META" disabled>
                        <span style="color: #f87171">â– </span> Meta
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-6" class="market-checkbox" data-symbol="AMD" disabled>
                        <span style="color: #fb923c">â– </span> AMD
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-7" class="market-checkbox" data-symbol="PLTR" disabled>
                        <span style="color: #34d399">â– </span> Palantir
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-8" class="market-checkbox" data-symbol="BOTZ" disabled>
                        <span style="color: #a78bfa">â– </span> AI/Robotics ETF
                    </label>

                    <label class="checkbox-label" style=" opacity: 0.4;">
                        <input type="checkbox" id="symbol-9" class="market-checkbox" data-symbol="AIQ" disabled>
                        <span style="color: #f472b6">â– </span> AI Analytics ETF
                    </label>

                </div>
            </div>
        </section>

        <script>
        function toggleEventSection(section, totalCount) {
            const button = document.getElementById(section + '-toggle-btn');
            const isExpanded = button.textContent.includes('Show Less');

            for (let i = 3; i < totalCount; i++) {
                const elem = document.getElementById(section + '-hidden-' + i);
                if (elem) {
                    elem.style.display = isExpanded ? 'none' : 'block';
                }
            }

            if (isExpanded) {
                button.textContent = 'Show ' + (totalCount - 3) + ' More Events';
            } else {
                button.textContent = 'Show Less';
            }
        }
        </script>
    </main>

    <footer>
        <p>Generated by AI-Pulse | Data from Hacker News, NewsAPI, SEC EDGAR, GitHub, Company IR</p>
        <p>Analysis powered by Claude (Anthropic)</p>
    </footer>
</body>
</html>
